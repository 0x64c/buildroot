#!/bin/sh

if [ $# -ne 1 ] ; then
	echo "Incorrect number of parameters.\nUsage:\n\tod-update <data_dir>"
	exit 1
fi

BOOTLD=$1/ubiboot.bin
KERNEL=$1/uzImage.bin
ROOTFS=$1/rootfs.squashfs

if [ -r $BOOTLD ] ; then
	echo "Updating bootloader..."
	flash_erase /dev/mtd0 0 1
	nandwrite -p /dev/mtd0 $BOOTLD
fi

if [ -r $KERNEL ] ; then
	echo "Updating kernel..."
	ubiupdatevol /dev/ubi0_1 $KERNEL
	ubirename /dev/ubi0 kernel kernel_bak kernel_bak kernel
fi

if [ -r $ROOTFS ] ; then
	echo "Updating rootfs..."
	cp $ROOTFS /boot/update_r.bin
fi

echo "All done!"
exit 0
